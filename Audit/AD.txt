Get-GPO "NEC Proxy"
Get-GPInheritance -Target "OU=RDC,DC=sw,DC=ukrenergo,DC=ent" | fl

# Если это необходимо, обработка локальных политик может быть полностью выключена. 
# Это предотвратит не рекомендуетмые настройки конкретного проиложения, которые не сможет контролировать администратор, 
# или о которых он может быть не осведомлён. Их можно запретить при помощи настройки Групповых политик. 
# Настройки этой политики расположены в Computer Configuration\Administrative Templates\System\Group Policy\Turn off Local Group Policy Objects Processing; для запрета обработки политики указанное значение следует установить в Enable.

# Когда нет особых причин для использования асинхронного режима, вам рекомендуется всегда применять синхронный режим. 
# Мы можем принудительно установить такое применение Групповых политик; Эти настройки групповой политики расположены в Computer Configuration\Administrative Templates\System\Logon\Always wait for the network at computer startup and logon.

# C:\Windows\PolicyDefinitions\* 

# Теперь мы знаем как применять эти разнообразные варианты фильтрации для целеуказания определённых объектов под GPO. Но в каком порядке они применяются? Приводимый ниже список поясняет установленный порядок обработки:

# LSDOU: Самым певый параметр будет основываться на том порядке, в котором политики помещены в установленной структуре домена. Это было подробно рассмотрено в начальных разделах данной главы.

# Фильтрация WMI: Наша следующая фильрация просматривает имеющиеся фильтры WMI, которые мы обсуждали в данном разделе. В случае успешного результата, данная Групповая политика проследует на следующий шаг. Когда результат отрицательный, эта Групповая политика не применятеся.

# Фильтрация безопасности: В качестве последнего этапа просматривается фильтрация безопасности и проверяется соответствие установленным критериям. Если оно присутствует, это приводит к обработке данной Групповой политики.

# Существует два режима обработки петель:

# Replace mode: В режиме замены те настройки пользователя, которые присоединены к данному пользователю из его оригинального OU будут замещены настройками пользователя, присоединёнными к OU назначения. Когда включён данный режим обработки петель заменами, если Liam входит в систему с ноутбука в переговорной комнате, он получит в точности те настройки, как и пользователь из OU IT operations.

# Merge mode: Когда включён режим слияния, в моём примере при его регистрации с ноутбука в переговорной комнате первыми будут применены настройки пользователя отдела продаж Liam. После обработки натроек Групповых политик также будут добавлены настройки пользователя из соответствующего OU IT operations. В случае наличия конфликтов выигравшими политиками будут политики пользователя OU IT operations.

# Для включения обработки петель в Групповых политиках пройдите в режим редактирования соответствующей Групповой политики и проследуйте к Computer Configuration| Policies| Administrative Templates | System | Group Policy | Configure user Group Policy loopback processing mode:

# Никогда не изменяйте установленные по умолчанию политики: Существует две установленные по умолчанию Групповые политики - Default Domain Policy и Default Domain Controllers Policy.

Имеется пять основных ролей Active Directory:
Active Directory Domain Services (AD DS)
Active Directory Lightweight Directory Services (AD LDS)
Active Directory Federation Services (AD FS)
Active Directory Rights Management Services (AD RMS)
Active Directory Certificate Services (AD CS)

Репликация AD

dfsrmig /getglobalstate

Миграция из FRS в DFRS имеет четыре состояния:
state 0 (Start, Пуск): Проинициализировав это состояние, FRS выполнит репликацию своей папки SYSVOL по всем контроллерам домена. Важно иметь современную копию своей папки SYSVOL перед началом общего процесса миграции.
state 1 (Prepared, Подготовлено): В данном состоянии пока FRS продолжает репликацию своей папки SYSVOL, DFSR также будет реплицировать некую копию имеющейся папки SYSVOL. Она будет находиться в %SystemRoot%SYSVOL_DFRS. Однако эта папка SYSVOL не будет отвечать ни на какие запросы служб всех прочих контроллеров домена.
state 2 (Redirected, Перенаправлено): В этом состоянии имеющаяся копия SYSVOL DFSR начнёт отвечать на запросы службы папки SYSVOL. FRS продолжит реплицирование своей собственной копии SYSVOL, но не будет вовлечён в репликации, производимые папками SYSVOL (DFSR).
state 3 (Eliminated, Удалено): В этом состоянии DFSR продолжит свои репликации и обслуживание запросов к своей папке SYSVOL. Windows удалит первоначальную папку SYSVOL, применявшуюся FRS для репликаций и остановит репликации FRS.

Для миграции из FRS в DFSR данная миграция должна пройти от состояния 0 до состояния 3.

dfsrmig /getmigrationstate

Get-ADReplicationSite -Filter *

В установленной инфраструктуре AD, KCC (Knowledge Consistency Checker, Проверка состоятельности знаний) это некий встроенный процесс, который запускается в контроллерах домена и отвечает за выработку топологии репликации.

Get-ADReplicationSubnet -Filter {Site -Eq "SW"}

Из PowerShell это можно осуществлять при помощи соответствующего параметра -ProtectedFromAccidentalDeletion $true.
Когда некий объект удалён из AD, он не удаляется окончательно. Как только некий объект удалён, ему устанавливается значение атрибута isDeleted в True,
а сам этот объект перемещается в CN=Deleted Objects.

Мы можем создавать необходимый моментальный снимок AD DS при помощи ntdsutil.

В состав резервной копии состояния системы входят следующие файлы:
- Файл базы данных AD DS (ntds.dit)
- Папка SYSVOL со всеми своими файлами
- Хранилище сертификатов
- профили пользователей
- Метабаза IIS (Internet Information Services)
- Файлы загрузки
- Папка кэша DLL (Dynamic-link library)
- Сведения реестра
- Сведения COM+ и WMI
- Сведения службы кластера
- Системные файлы Windows Resource Protection.
		

