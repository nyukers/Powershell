########################
Перевод Mdl®Документация Virtualization and Cloud
Windows Server 2016 Hyper-V Книга рецептов. 2е изд

Глава 3. Управление настройками диска и сетевой среды
Глава 5. Практический опыт, советы и трюки Hyper-V

########################
MS Assesment and Planning Toolkit (MAP) можно оценить готовность ПК в сети к виртуализации в MS HyperV.

MS HyperV это роль.
Одновременно может быть не более 2-х.

Можно инсталировать  Win10 MS HyperV Management toolkit без установки самого MS HyperV. Также надо отключить Enhanced Session Mode.
Enhanced Session Mode в MS HyperV требует включения Guest Services.

Copy+Paste между VM возможен только при включенном Enhanced Session Mode.

Snapshots можно экспортировать: Export-VMSnapshot

Мониторинг ресурсов потребления в конкретной ВМ:
Get-VM -Name ssw-regina-exchange-10.13.2.30 | Enable-VMResourceMetering
Get-VM -Name ssw-regina-exchange-10.13.2.30 | Measure-VM

На хосте все настройки реального NIC переходят в vEthernetSwitch.
Get-VMNetworkAdapter -all

Move-VMStorage
Install-WindowsFeature RSAT-AD-AdminCenter

Resource Pool настраивается только через Powershell и позволяет объединить многие ресурсы в пул и перераспределять их между ВМ во время работы.
Тут же нужно рассматривать NIС Teaming....

Automatic Start Action - запускать автоматом если она была запущена при останове MS HyperV.

Журналы MS HyperV имеют префикс в названии Hyper-V-*.

Для выполнения чекпоинта рекомендуется ставить VM на паузу.
Для оценки истории работы ВМ можно пользоваться Windows Reliability Monitor.

########################
Для соединения ресурсов в одно целое и чтобы сделать более простым их выделение и измерение, в Windows 2012 Hyper-V было введено понятие пулоа ресурсов.
Основная идея пулов ресурсов состоит в том, чтобы помещать выделяемые виртуальным системам ресурсы в некий пул. В Hyper-V могут применяться следующие типы ресурсов:
* Оперaтивная память
* Процессор
* Ethernet
* VHD (Virtual Hard Disks)
* ISO
* VFD (Virtual Floppy Disks)
* Порты Fibre Channel
* Соединения Fibre Channel
* PciExpress

В данном рецепте мы увидим некоторые примеры наиболее распространённых пулов ресурсов, таких как пулы хранения и пулы Ethernet.

LBFO (Load Balance and Failover, Балансировка нагрузки и устойчивость к отказам), 
связывание NIC (NIC bonding) или группирование NIC (NIC teaming). 
Мы будем применять терминологию Microsoft, группирование NIC (NIC teaming). 

Имеются три режима настройки для группирования NIC. Режимом по умолчанию является независимая коммутация (switch independent). 
В данном случае сам коммутатор не знает что данный сетевой адаптер участвует в группировании, тем самым позволяя ему подключение к различным коммутаторам. 
Следующим режимом является статическое группирование (static teaming). Оно требует того, чтобы данный коммутатор и данный компьютер были настроены на то, 
чтобы иметь возможность определения проблем с имеющимися сетевыми адаптерами. 
Последним из трёх режимов является LACP (Link Aggregation Control Protocol, Управляющий протокол агрегации связей). LACP определяет связи динамически. 
В большинстве случаев самому LACP необходима ручная настройка для включения применения этого протокола данного порта.

Windows Server 2008 R2 SP1 ввёл новую функциональность, называемую Dynamic Memory (DM, Динамичской памятью), которая позволяет совместно применять 
оперативную память хоста всеми ВМ, использующими метод с названием Ballooning (Надувание). 
Ballooning гарантирует что ваши ВМ используют только ту оперативную память, которая им требуется и освобождает её обратно своему хосту или другой ВМ, 
которой требуется больше оперативной памяти. Это делает возможным автоматически перераспределять между ВМ имеющуюся в в родительском разделе 
оперативную память, увеличивая или уменьшая её потребление на основании текущей рабочей нагрузки.

Однако, Динамическая память не приемлема для всех рабочих нагрузок, например, таких как SQL или сервер Exchange. 
В Windows Server 2016 Microsoft ввёл новую функциональность с названием Runtime Memory Resize (Изменение размера памяти времени исполнения), 
которая делает возможной для вас в горячем режиме добавлять и удалять оперативную память для статических (выполняющихся) ВМ.

В Windows Server 2012 Microsoft ввёл поддержку для проектирования виртуальной топологии NUMA (Архитектуры с неравномерной памятью, 
Non-Uniform Memory Access) в ВМ Hyper-V усилив существующие физические узлы NUMA в работающей системе. 
Эта возможность может помочь улучшению производительности рабочей нагрузки выполняемой ВМ которая настроена на большие объёмы оперативной памяти.
Помните, что если некая ВМ использует Динамическую память, тогда для этой ВМ Виртуальная NUMA отключена.

Антивирус:

Откройте своё программное обеспечение на данном компьютере хоста и добавьте _исключения_ для следующих каталогов и файлов на основании текущих настроек местоположений этих файлов:
* Каталоги, применяемые для файлов настроек машины
* Каталоги, используемые для файлов виртуальных жёстких дисков
* Каталоги моментальных снимков
* Процессы Vmms.exe, Vmsp.exe, Vmconnect.exe, Vmcompute.exe и Vmwp.exe.
* Все прочие индивидуальные каталоги настроек
* Каталог CSV C:\ClusterStorage (для кластерных окружений).

######################
Для взаимодействия с виртуальной машиной виртуальная консоль Hyper-V использует
протокол удаленного рабочего стола (Remote Desktop Protocol - RDP); это тот
же самый протокол, который применяется для Remote Desktop Services. Отличие в
том, что он не использует стандартный порт RDP, а взамен работает с ТСР-портом
2179. Когда вы запускаете виртуальную консоль из диспетчера Hyper-V, она стартует
клиентское приложение vmconnect. ехе, находящееся в %programfiles% \hyper-v.
Это приложение похоже на клиента Remote Desktop Client, но вдобавок позволяет
выбирать виртуальную машину, к которой необходимо подключиться. Служба управления
виртуальными машинами (Virtual Machine Maпagement Service) является прослушивающей
службой. Когда вы подключаетесь к ней с помощью vmconnect. ехе,
она сообщает клиенту, какие виртуальные машины доступны, и обеспечивает поступление
RDР-трафика на подходящую виртуальную машину. Другими словами, эта
служба действует как мультиплексор RDP.


Чтобы создать новую контрольную точку виртуальной машины со специальным именем, введите следующую
команду:
Checkpoint-VM -Name "WS2012R2-SRV" -SnapshotName "Before Service Pack Install"
